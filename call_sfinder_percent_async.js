const { exec } = require("child_process");
const { decoder, encoder} = require('tetris-fumen');

function asyncExec(command) {
    return new Promise((resolve, reject) => {
        exec(command, (error, stdout, stderr) => {
            if (error) {
                reject(error);
                return;
            }
            if (stderr) {
                reject(new Error(stderr));
                return;
            }
            resolve(stdout);
        });
    });
}

async function call_sfinder_percent(fumens) {
    // Find the index of '?'
    const index = fumens.indexOf('?');
    let pages = decoder.decode(fumens.substring(index + 1));

    const commands = [];

    for (let i = 0; i < pages.length; i++) {
        let fumen = encoder.encode([pages[i]]);

        let command = `java -jar sfinder.jar percent --clear 6 --drop 180 --tetfu ${fumen} --patterns *p7 --log-path "output/percents/${i}.txt"`;
        commands.push(command);
    }

    const promises = commands.map(async (command, i) => {
        try {
            const result = await asyncExec(command);
            // Handle the result as needed
        } catch (error) {
            console.error(`Error executing command ${i + 1}: ${error.message}`);
            // Handle errors
        }
    });

    await Promise.all(promises);

    return pages.length;
}

// fumens = 'http://fumen.zui.jp/?v115@ugRpHeRpHeA8BtBeA8DeB8BtAeC8ywH8wwE8JeAgWJ?AWQTABhAlFDvAAAA+gRpBewwwhAtBeA8RpBexwBtAeC8xww?SBtB8AeC8wwBeBtA8JeAAAzgRpHeRpCeA8BtBeA8DeB8BtA?eA8zwwSBtB8AexwA8wwBeBtA8JeAAAtgRpHeRpIeA8BtBew?wwSCeB8BtAexwA8xwwSBtB8AeC8wwBeBtA8JeAAAsgBtIeB?tHewSwwBeRpA8CewSwwA8AeRpC8xwwSBtB8AeC8wwBeBtA8?JeAAPJAWQTABhAdgC6AAAAsgBtIeBtGeBPA8AeRpAeA8CeA?PAtA8RpAeC8xwwSB8xwAeC8wwBeA8xwJeAAAsgBtIeBtRpE?eBPA8RpBeA8CeAPAtA8CeC8xwwSA8xwA8AeC8wwBexwA8Je?AAAugRpHeRpBeAtCeBPA8BeBtA8CeAPAtwwwSAtAeC8xwwS?xwB8AeC8wwBeC8JeAAPJAWQTABhAlFDvAAAA8gAtAeRpBew?wwSAeBtA8RpBexwAeAtAPC8xwwSB8BtAeC8wwBeA8AtA8Je?AAPJAWQTABhAdgC6AAAAzgRpGeAtRpCeA8BeBtA8DeB8AeA?tAPA8zwwSB8BtAexwA8wwBeA8AtA8JeAAPJAWQTABhAlFDv?AAAAtgRpHeRpCeAtEeA8BeBtwwwSCeB8AeAtAPxwA8xwwSB?8BtAeC8wwBeA8AtA8JeAAA5gRpAeAtDewSwwRpBtA8CewSw?wA8AeAtAPC8xwwSB8BtAeC8wwBeA8AtA8JeAAA1gAtHeBtB?eA8BeRpA8AtCeA8wwwSQpQaC8xwwSxwBtAeC8wwBeA8AtA8?JeAAPJAWQTABhAdgC6AAAAugRpEeAtBeRpDeBtBeA8DeA8A?tAPBeB8CeA8BtxwwSB8xwAeAtB8wwBeA8xwJeAAPJAWQTAB?hAlFDvAAAA1gAtHeBtBewwwSRpAeA8AtAPBexwRpAeA8Btx?wwSD8AeAtB8wwBeC8JeAAPJAWQTABhAdgC6AAAA1gAtCeRp?CeBtBeA8RpBeA8AtAPBeB8CeA8BtxwwSA8xwA8AeAtB8wwB?exwA8JeAAPJAWQTABhAlFDvAAAA9gBtCeA8BeRpA8AtCeA8?wwwSRpA8BtxwwSxwB8AeAtB8wwBeC8JeAAAugRpHeRpCeBt?CeA8DeA8BtBeB8CeBtA8xwwSB8xwAeBtA8wwBeA8xwJeAAA?9gBtCewwwSRpAeA8BtBexwRpAeBtA8xwwSD8AeBtA8wwBeC?8JeAAAtgRpHeRpDeBtCeA8DeA8BtBeB8CeBtA8xwwSA8xwA?8AeBtA8wwBexwA8JeAAA5gRpBeBtBewSwwRpBeA8BtAewSw?wA8CeBtA8xwwSD8AeBtA8wwBeC8JeAAAqgAtHeBtHeAtDeA?8BeRpA8DeA8wwwSRpBtA8xwwSxwB8AeBtA8wwBeC8JeAAPJ?AWQTABhAdgC6AAAAqgAtCeRpCeBtCeRpCeAtAPCeA8DeAtA?PCeB8CeAtB8xwwSB8xwAeC8wwBeA8xwJeAAPJAWQTABhAlF?DvAAAAqgAtHeBtHeAtQaQpBewwwSCeAtQaQpBexwCeAtB8x?wwSD8AeC8wwBeC8JeAAPJAWQTABhAdgC6AAAAqgAtHeBtHe?AtAPCeA8AeRpAeAtAPCeB8RpAeAtzwwSD8AexwA8wwBeC8J?eAAAqgAtBeRpDeBtBeRpDeAtAPCeA8DeAtAPCeB8CeAtB8x?wwSA8xwA8AeC8wwBexwA8JeAAPJAWQTABhAlFDvAAAAqgAt?HeBtDeRpBeAtAPBewSwwRpBeAtAPBewSwwA8CeAtB8xwwSD?8AeC8wwBeC8JeAAPJAWQTABhAdgC6AAAA4gBtDeAPCeA8Bt?RpAtAPCeA8wwwSRpAtB8xwwSxwB8AeC8wwBeC8JeAAA4gBt?DeRpBeA8BtBeA8RpBeBtCeC8xwwSBtxwAeC8wwBeA8xwJeA?AAzgRpCeBtCeRpCeA8BtBeA8DeBtCeA8zwwSBtB8AexwA8w?wBeC8JeAAPJAWQTABhAlFDvAAAAwgAtHeBtGeA8AtAeRpww?wSCeBtAeRpxwA8xwwSBtB8AeC8wwBeC8JeAAPJAWQTABhAd?gC6AAAAwgAtHeBtCeRpBeA8AtAPBeA8RpBeA8AtAPBeC8xw?wSAtA8xwAeC8wwBeA8xwJeAAAwgAtBeRpDeBtBeRpCeA8At?APBeA8DeA8AtAPBeA8zwwSAtC8AexwA8wwBeC8JeAAAwgAt?HeBtGeA8AtQaQpAewwwSCeA8AtQaQpAexwA8xwwSAtC8AeC?8wwBeC8JeAAAtgRpAeAtFeRpBtGeA8AtAPBeA8DeA8AtAPB?eC8xwwSAtxwA8AeC8wwBexwA8JeAAPJAWQTABhAlFDvAAAA?ugRpHeRpGewSwwBeAtAeA8CewSwwAtAPBtC8xwwSAtC8AeC?8wwBeC8JeAAA+gRpBewwwSBtAeA8RpBexwAeBtC8xwwSA8B?tA8AeC8wwBeA8BtJeAAAzgRpHeRpCeA8AeBtAeA8DeB8AeB?tA8zwwSA8BtA8AexwA8wwBeA8BtJeAAAtgRpHeRpIeA8AeB?tAewwwSCeB8AeBtxwA8xwwSA8BtA8AeC8wwBeA8BtJeAAAu?gRpHeRpAeAtEewSwwAeBtAeA8CewSwwA8AtBeC8xwwSA8Bt?A8AeC8wwBeA8BtJeAAA7gAtBeRpBewwwSBtAeA8RpBexwAt?APAeC8xwwSA8BtA8AeC8wwBeAtB8JeAAPJAWQTABhAdgC6A?AAAzgRpFeAtAeRpCeA8AeBtAeA8DeB8AtAPAeA8zwwSA8Bt?A8AexwA8wwBeAtB8JeAAPJAWQTABhAlFDvAAAAtgRpHeRpB?eAtFeA8AeBtAewwwSCeB8AtAPAexwA8xwwSA8BtA8AeC8ww?BeAtB8JeAAAtgBtIeBtGewSwwBeRpA8CewSwwA8AeQaQpC8?xwwSA8BtA8AeC8wwBeAtB8JeAAPJAWQTABhAdgC6AAAAtgB?tIeBtDeRpAeAPAtDeA8RpBeBtCeC8xwwSB8xwAeC8wwBeA8?xwJeAAAtgBtDeRpCeBtCeRpBeAPAtDeA8DeBtCeA8zwwSD8?AexwA8wwBeC8JeAAAtgBtIeBtGeAPAtAeRpAewwwSCeBtRp?AexwA8xwwSD8AeC8wwBeC8JeAAAsgBtIeBtEeRpAeAPAtDe?A8RpBeBtCeC8xwwSA8xwA8AeC8wwBexwA8JeAAPJAUQTABh?AdgC6AAAAsgBtEeRpBeBtDeRpAeBPA8DeA8CeAPAtA8CeA8?zwwSD8AexwA8wwBeC8JeAAAtgRpFeAtAeRpEeBtBPA8Deww?whBeAPAtA8CexwA8xwwSD8AeC8wwBeC8JeAAPJAUQTABhAl?FDvAAAA+gBtAewSwwBeRpA8BeAtwSwwA8AeRpA8BtxwwSD8?AeAtB8wwBeC8JeAAPJATQTABhAlFDvAAAAugRpHeRpDeBtB?eA8DeA8AeBtAeB8CeA8BtxwwSB8xwAeA8BtwwBeA8xwJeAA?A+gBtBewwwSRpAeA8AeBtAexwRpAeA8BtxwwSD8AeA8Btww?BeC8JeAAAtgRpHeRpEeBtBeA8DeA8AeBtAeB8CeA8BtxwwS?A8xwA8AeA8BtwwBexwA8JeAAA5gRpCeBtAewSwwRpBeA8Ae?BtwSwwA8CeA8BtxwwSD8AeA8BtwwBeC8JeAAAxgAtHeBtFe?A8AeAtRpA8DeA8wwwSRpA8BtxwwSxwB8AeA8BtwwBeC8JeA?APJATQTABhAdgC6AAAAwgBtIeBtEeA8BeQaQpA8DeB8APQa?QpC8xwwSA8AtxwAeC8wwBeA8xwJeAAAwgBtIeBtEeA8AeRa?AeA8DeB8QpQaAPC8xwwSB8xwAeC8wwBeA8xwJeAAAwgBtGe?RpBtEeA8QpQaAPAeA8DeB8AeBPC8xwwSA8xwA8AeC8wwBex?wA8JeAAA7gRpEeA8AtAeQaQpA8DeA8wwwhAeAPC8xwwSxwB?8AeC8wwBeC8JeAAPJATQTABhAlFDvAAAAvgRpHeRpGeA8Bt?BeA8DeB8AtwhwSC8xwwSBtxwAeC8wwBeBtA8JeAAA/gRpAe?A8xhBeA8AeRpAeA8wwwhAtAeC8xwwSBtB8AeC8wwBeBtA8J?eAAAwgRpHeRpFeA8BtBeA8DeB8BtAeB8wwglwwwSBtB8AeA?8ywBeBtA8JeAAAAhRpA8AtwhwSAeA8BeRpB8xhAeC8xwwSB?tB8AeC8wwBeBtA8JeAAAsgBtIeBtFeRpAeA8DeA8AeRpAeB?8CeC8hlwSBtB8AeB8wwglBeBtA8JeAAPJATQTABhAdgC6AA?AAsgBtIeBtGeRaA8DeA8BeQpQaAtA8CeB8wwglwwwSD8AeA?8ywBeC8JeAAA8gAtBeQpQaAPA8BeBtA8AeRpAPAtA8AeAtA?eC8hlwSD8AeB8wwglBeC8JeAAAwgRpHeRpAtEeA8BeBtA8D?eB8AeAtAPB8wwglwwwSB8BtAeA8ywBeA8AtA8JeAAPJATQT?ABhAlFDvAAAA8gAtCeRpA8AewSwhAtA8BeRpB8wSwhAPC8x?wwSB8BtAeC8wwBeA8AtA8JeAAPJATQTABhAdgC6AAAAugAt?HeBtHeAtA8BeRpA8DeB8AeQpQaC8hlwSB8BtAeB8wwglBeA?8AtA8JeAAAugAtHeBtEeRpAeBtDeA8RpAeAPAtA8CeC8www?hwSB8xwAeC8wwBeA8xwJeAAAugAtDeRpBeBtDeRpBeBtDeA?8CeAPAtA8CeA8ywwhwSD8AexwA8wwBeC8JeAAAugAtHeBtH?eBtAeRpAewwwSBeAPAtA8RpAexwA8wwwhwSD8AeC8wwBeC8?JeAAAugAtHeBtRpFeBtRpBeA8CeAPAtA8CeC8wwwhwSA8xw?A8AeC8wwBexwA8JeAAA1gAtHeBtRpAtDeA8AtAeQpQaAtww?wSBeC8wwwhwSxwB8AeC8wwBeC8JeAAApgRpHeRpAtHeBtBe?A8DeA8AtAPBeB8CeA8BthlwSD8AeAtA8wwglBeC8JeAAPJA?TQTABhAlFDvAAAAqgRpHeRpGexhCeA8DewwwhCeB8CeA8Bt?xwwSD8AeAtB8wwBeC8JeAAA9gAtwhwSRpA8DeA8xhRpB8Ce?BtA8xwwSD8AeBtA8wwBeC8JeAAApgRpHeRpHeBtCeA8DeA8?BtBeB8CeBtA8hlwSD8AeBtwwglBeC8JeAAAvgBtIeBtAexS?CeA8BeRpwwwSCeB8AeRpBtA8xwwSD8AeBtA8wwBeC8JeAAP?JATQTABhAdgC6AAAAvgBtIeBtFeA8APQaQpAeA8DeB8RaAe?C8xwwSB8xwAeC8wwBeA8xwJeAAApgBtIeBtHeRpBeA8BPBe?A8RpBeB8BPAeC8xwwSA8xwA8AeC8wwBexwA8JeAAA2gAtFe?BPBtAeA8BeRpA8APCeB8AeRpA8zwwSD8AexwA8wwBeC8JeA?AAugRpFeAtAeRpEeBtAeA8DeA8AeAtAPAeB8CeB8Atwhwww?SB8xwAeA8AtA8wwBeA8xwJeAAPJATQTABhAlFDvAAAAzgRp?AeAtFeRpBtAewwwSCeA8AeAtAPAexwCeB8AtwhwwwSD8AeA?8AtA8wwBeC8JeAAA2gAtHeBtAeA8AeRpAewwwSAtAPAeB8R?pAexwAtwhwwwSD8AeA8AtA8wwBeC8JeAAPJATQTABhAdgC6?AAAAtgRpGeAtRpFeBtAeA8DeA8AeAtAPAeB8CeB8Atwhwww?SA8xwA8AeA8AtA8wwBexwA8JeAAPJATQTABhAlFDvAAAA2g?AtBeRpDeBtwSwwRpBeA8AeAtAPwSwwA8CeB8AtwhwwwSD8A?eA8AtA8wwBeC8JeAAAqgAtHeBtHeAtAeRpAeA8DeA8AeQpQ?aAeA8wwwSBeB8AtwhwwwSxwB8AeA8AtA8wwBeC8JeAAPJAT?QTABhAdgC6AAAAqgAtHeBtHeAtAPAeRpA8DeAtAPAeRpB8C?eAtA8wwglwwwSD8AeA8ywBeC8JeAAAugBtIeBtCeAPCeA8A?eRpAeAtAPCeB8RpAeAtB8hlwSD8AeB8wwglBeC8JeAAA/gB?tAeAtAPAeRpA8BeBtA8AtAPRpC8xwwSA8xwA8AeC8wwBexw?A8JeAAPJATQTABhAlFDvAAAAugRpHeRpEeBtAeA8DeA8BeB?tB8CeB8AtwhwwwSB8xwAeB8AtwhBeA8xwJeAAAzgRpHeRpB?tAewwwSCeA8BeBtxwCeB8AtwhwwwSD8AeB8AtwhBeC8JeAA?A/gBtAeA8AeRpAewwwSAeBtB8RpAexwAtwhwwwSD8AeB8At?whBeC8JeAAAtgRpHeRpFeBtAeA8DeA8BeBtB8CeB8Atwhww?wSA8xwA8AeB8AtwhBexwA8JeAAA5gRpDeBtwSwwRpBeA8Be?AtwhwwA8CeB8AtwhwwwSD8AeB8AtwhBeC8JeAAA4gBtEeRp?AeA8BtBeA8AeRpAeA8wwwSBeB8AtwhwwwSxwB8AeB8AtwhB?eC8JeAAPJATQTABhAdgC6AAAAwgRpFeBtRpFeA8BtBeA8De?BtCeB8wwglwwwSBtB8AeA8ywBeC8JeAAPJATQTABhAlFDvA?AAA4gBtFeRpA8AtwhwSAeA8BeRpBtxSAeC8xwwSBtB8AeC8?wwBeC8JeAAPJATQTABhAdgC6AAAAwgAtHeBtDeRpAeA8AtC?eA8AeRpAeBtCeC8hlwSBtB8AeB8wwglBeC8JeAAAwgAtHeB?tEeRpA8AtAPBeA8BeRpA8AtAPBeB8wwglwwwSAtC8AeA8yw?BeC8JeAAA3gAtHeBtA8AeAPRpA8BeAtAeA8AtAPRpC8hlwS?AtC8AeB8wwglBeC8JeAAAugRpGeAtRpFeBtA8DeA8BeAtAP?B8CeC8xhwSB8xwAeB8AtwwBeA8xwJeAAPJATQTABhAlFDvA?AAA3gAtFeRpBtwwwSCeA8RpAtAPxwCeC8xhwSD8AeB8Atww?BeC8JeAAPJATQTABhAdgC6AAAAzgRpBeAtEeRpAeBtA8DeA?8BeAtAPB8CeA8xwxhwSD8AexwAtwwBeC8JeAAPJATQTABhA?lFDvAAAA3gAtHeBtA8AeRpAewwwSAeAtAPB8RpAexwA8xhw?SD8AeB8AtwwBeC8JeAAPJATQTABhAdgC6AAAA3gAtAeRpEe?BtA8RpBeA8BeAtAPB8CeC8xhwSA8xwA8AeB8AtwwBexwA8J?eAAPJATQTABhAlFDvAAAAvgRpHeRpGeA8AeBtAeA8CeAPA8?wwwSBtC8xhwSxwB8AeB8AtwwBeC8JeAAA/gRpAeA8wSwhAt?AeA8AeRpAeA8wwwSBtC8xwwSA8BtA8AeC8wwBeA8BtJeAAA?wgRpHeRpFeA8AeBtAeA8DeB8AeBtB8wwglwwwSA8BtA8AeA?8ywBeA8BtJeAAAAhRpA8AexhAeA8BeRpB8wSwhAtC8xwwSA?8BtA8AeC8wwBeA8BtJeAAAxgRpHeRpEeA8AeBtAeA8DeB8A?eBtC8hlwSA8BtA8AeB8wwglBeA8BtJeAAAvgRpHeRpAtFeA?8AeAtwhwSA8DeB8AtxSC8xwwSA8BtA8AeC8wwBeA8BtJeAA?A7gAtCeRpAeA8wSwhAtAeA8AeRpAeA8wwwhAPAeC8xwwSA8?BtA8AeC8wwBeAtB8JeAAPJATQTABhAdgC6AAAA7gAtDeRpA?8AeBtAeA8BeRpB8AtAPAeB8wwglwwwSA8BtA8AeA8ywBeAt?B8JeAAAtgBtIeBtEeRpAeA8DeA8AeRpAeB8AeAPAeC8hlwS?A8BtA8AeB8wwglBeAtB8JeAAAtgBtIeBtFeQpQaAtDeA8Be?RpBtCeB8wwglwwwSD8AeA8ywBeC8JeAAAugAtHeBtFeRpAe?AtDeA8AeRpAeBtCeC8hlwSD8AeB8wwglBeC8JeAAPJASQTA?BhAdgC6AAAAqgBtIeBtGeRpBeAtDeA8RpAeAPAtA8CeB8ww?glwhwSD8AeA8ywBeC8JeAAAqgBtGeRpBtFeQpQaAPBeA8De?A8AeBPAeB8CeA8zwwSD8AexwA8wwBeC8JeAAA1gRpFeAtAe?QaQpAeA8DewwwhAeAPAeB8CexwA8xwwSD8AeC8wwBeC8JeA?APJASQTABhAlFDvAAAA1gBtGeRpBtA8DeA8QpAewSAeB8Ce?BtwwglwwwSD8AeBtA8wwBeC8JeAAPJASQTABhAdgC6AAAAq?gRpHeRpHeBtBeA8DeA8DeB8CeA8xwxhwSD8AexwA8wwBeC8?JeAAPJARQTABhAlFDvAAAArgRpHeRpGexhBeA8DeA8wSwhA?tAeB8CeA8BtxwwSD8AeA8BtwwBeC8JeAAA2gRpFeAtwhAeQ?pA8DeA8AexhAeB8CeA8BtxwwSD8AeA8BtwwBeC8JeAAApgR?pHeRpIeBtBeA8DeA8AeAtwhwSB8CeA8BthlwSD8AeA8Btww?BeC8JeAAAqgBtIeBtFexSRpAeA8DewwwSRpAeB8CeA8Btxw?wSD8AeA8BtwwBeC8JeAAPJARQTABhAdgC6AAAAqgBtIeBtG?eBPRpA8DeA8AeAPQaQpB8CeB8wwglwwwSD8AeA8ywBeC8Je?AAArgBtIeBtFeAPQaQpAeA8DeA8AeRaAeB8CeC8hlwSD8Ae?B8wwglBeC8JeAAArgBtIeBtGeAPQaQpA8DeA8BeRaB8CeB8?wwglwwwSD8AeA8ywBeC8JeAAArgAtHeBtHeAtRaAeA8DeA8?AeQpQaAPB8CeC8hlwSD8AeB8wwglBeC8JeAAApgBtIeBtIe?QaQpAeA8DeA8APQaQpAeB8CeA8AtwwglwwwSD8AeA8ywBeC?8JeAAAqgRpHeRpAtFeBPBtAeA8DeA8APCeB8CeB8wwglwww?SD8AeA8ywBeC8JeAAPJARQTABhAlFDvAAAAqgRpHeRpHewS?whAtAeA8DeA8xSAeAtB8CeB8AtwhwwwSD8AeA8AtA8wwBeC?8JeAAArgRpHeRpGewSwhAtAeA8DeA8xSBtB8CeB8Atwhwww?SD8AeB8AtwhBeC8JeAAAsgRpHeRpGexhAeA8DeA8AewSwhA?tB8CeB8AtwhwwwSD8AeB8AtwhBeC8JeAAAsgAtHeBtHeAtB?eA8DeA8DeB8CeB8AtwhwwwSD8AeB8AtwhBeC8JeAAPJARQT?ABhAdgC6AAAArgRpHeRpAtIeAtA8DeA8AeAPBeB8CeB8Ath?lwSD8AeB8wwglBeC8JeAAPJARQTABhAlFDvAAAA'
//
// call_sfinder_percent(fumens);

module.exports = {call_sfinder_percent};
